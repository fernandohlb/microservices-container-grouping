version: '3'

services:
  benchmark:
    image: locustio/locust
    ports:
     - "8089:8089"
    volumes:
      - ./:/mnt/locust:rw
    environment:
      - numUsers=${numUsers}
      - spawnRate=${spawnRate}
      - time=${time}
      - timeOut=${timeOut}
      - benchmarkHost=${benchmarkHost}
    command: -f /mnt/locust/locustfile.py --master -H $benchmarkHost --headless --only-summary --html /mnt/locust/reports/benchmark_report.html -u $numUsers -r $spawnRate -t $time --stop-timeout $timeOut

  worker_benchmark:
    image: locustio/locust
    volumes:
      - ./:/mnt/locust:rw
    command: -f /mnt/locust/locustfile.py --worker --master-host benchmark
  
  # allinone:
  #   image: locustio/locust
  #   ports:
  #    - "8090:8089"
  #   volumes:
  #     - ./:/mnt/locust
  #   environment:
  #     - numUsers=${numUsers}
  #     - spawnRate=${spawnRate}
  #     - time=${time}
  #     - timeOut=${timeOut}
  #     - allinoneHost=${allinoneHost}
  #   command: -f /mnt/locust/locustfile.py --master -H $allinoneHost --headless --only-summary --html /mnt/locust/reports/allinone_report.html -u $numUsers -r $spawnRate -t $time --stop-timeout $timeOut

  # worker_allinone:
  #   image: locustio/locust
  #   volumes:
  #     - ./:/mnt/locust
  #   command: -f /mnt/locust/locustfile.py --worker --master-host allinone
